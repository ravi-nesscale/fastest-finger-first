var N=(t,o,s)=>new Promise((n,e)=>{var a=i=>{try{d(s.next(i))}catch(f){e(f)}},p=i=>{try{d(s.throw(i))}catch(f){e(f)}},d=i=>i.done?n(i.value):Promise.resolve(i.value).then(a,p);d((s=s.apply(t,o)).next())});import{_ as S,e as u,c,F,m as C,n as P,t as g,a as m,f as I,p as R,r,l as B,o as L,q as M,g as j,x as G,b as w,u as J}from"./index-BAFYT2am.js";const V={class:"navbar"},z=["disabled","onClick"],U={__name:"Navbar",props:{questions:Array,activeIndex:Number,disabledQuestions:Array},emits:["select-question"],setup(t){return(o,s)=>(u(),c("nav",V,[(u(!0),c(F,null,C(t.questions,(n,e)=>(u(),c("button",{key:n.name,class:P(["nav-button",{active:t.activeIndex===e}]),disabled:t.disabledQuestions.includes(e),onClick:a=>o.$emit("select-question",e)},g(e+1),11,z))),128))]))}},H=S(U,[["__scopeId","data-v-59dcc0a1"]]),K={key:0,class:"question-card"},W={class:"options-grid"},X=["onClick"],Y={class:"option-number"},Z={class:"option-text"},ee={key:0,class:"timer-slot"},te={__name:"QuestionDisplay",props:{question:Object,options:Array,selectedOption:Number},emits:["select-option"],setup(t){return(o,s)=>(u(),c("div",null,[t.question?(u(),c("div",K,[m("h2",null,g(t.question.question_text),1)])):I("",!0),m("div",W,[(u(!0),c(F,null,C(t.options,(n,e)=>(u(),c("div",{key:e,class:P(["option-item",{selected:t.selectedOption===e}]),onClick:a=>o.$emit("select-option",e)},[m("span",Y,g(e+1),1),m("span",Z,g(n),1)],10,X))),128)),t.options.length===4?(u(),c("div",ee,[R(o.$slots,"timer",{},void 0,!0)])):I("",!0)])]))}},se=S(te,[["__scopeId","data-v-16c47151"]]),oe={class:"timer"},ne={class:"text-xl font-semibold text-white"},ae={__name:"Timer",setup(t,{expose:o}){const s=r(null),n=r(0);let e=null;const a=B(()=>p());function p(){const _=n.value,y=String(Math.floor(_/6e4)).padStart(2,"0"),q=String(Math.floor(_%6e4/1e3)).padStart(2,"0"),x=String(Math.floor(_%1e3/10)).padStart(2,"0");return`${y}:${q}:${x}`}function d(){s.value&&(n.value=Date.now()-s.value)}function i(){clearInterval(e),e=setInterval(d,50)}function f(){s.value||(s.value=Date.now()-n.value,localStorage.setItem("timerStart",s.value),d(),i())}function b(){clearInterval(e),s.value&&(d(),localStorage.removeItem("timerStart"),s.value=null)}function T(){b(),n.value=0}return L(()=>{const _=localStorage.getItem("timerStart");_?s.value=parseInt(_):(s.value=Date.now(),localStorage.setItem("timerStart",s.value)),i(),d()}),M(()=>{clearInterval(e)}),o({startTimer:f,pauseTimer:b,resetTimer:T,getFormattedTime:()=>a.value}),(_,y)=>(u(),c("div",oe,[m("div",ne,g(a.value),1)]))}},ie=S(ae,[["__scopeId","data-v-fa1c96eb"]]),le=j({name:"AudioPlayer",setup(){const t=r(null),o=r(!1),s=()=>N(this,null,function*(){try{if(!t.value)return;yield t.value.play(),o.value=!0,console.log("Audio playing")}catch(a){console.warn("Audio play failed (possibly due to autoplay restrictions):",a)}}),n=()=>{t.value&&(o.value?(t.value.pause(),o.value=!1):s())},e=()=>{o.value||s(),window.removeEventListener("click",e)};return L(()=>{t.value&&(t.value.loop=!0,t.value.volume=.5),window.addEventListener("click",e)}),M(()=>{window.removeEventListener("click",e)}),{audio:t,isPlaying:o,toggleAudio:n}}}),re={class:"audio-control"},ue={ref:"audio",src:"/media/kbc_theme.mp3",hidden:""},ce=["aria-label"];function de(t,o,s,n,e,a){return u(),c("div",re,[m("audio",ue,null,512),m("button",{onClick:o[0]||(o[0]=(...p)=>t.toggleAudio&&t.toggleAudio(...p)),"aria-label":t.isPlaying?"Stop background music":"Play background music"},g(t.isPlaying?"⏸ Stop Music":"▶️ Play Music"),9,ce)])}const me=S(le,[["render",de],["__scopeId","data-v-9191d5b2"]]),ve={class:"container"},pe={class:"submit-button"},_e=["disabled"],fe={key:0,class:"mt-4 text-lg font-semibold text-green-400"},ge={key:1,class:"transition-screen"},be={__name:"Gamesession",setup(t){const o=r(null),s=J(),n=r([]),e=r(0),a=r(null),p=r({}),d=r([]),i=r(""),f=r([]),b=r(!1),T=localStorage.getItem("user_id"),_=localStorage.getItem("user_name");G({doctype:"Question",fields:["name","question_text","option_1","option_2","option_3","option_4","correct_answer"],auto:!0,onSuccess(v){n.value=v,v.length>0&&y(0)}});const y=v=>{var $,k;e.value=v,a.value=null;const l=n.value[v];p.value=l,d.value=[l.option_1,l.option_2,l.option_3,l.option_4].filter(Boolean),($=o.value)==null||$.resetTimer(),(k=o.value)==null||k.startTimer()},q=v=>{a.value=v},x=()=>{b.value=!0,setTimeout(()=>{y(e.value+1),b.value=!1},2e3)},D=()=>N(this,null,function*(){var O,Q;const v=((O=o.value)==null?void 0:O.getFormattedTime())||"00:00:00";i.value=v;const l=p.value,$=d.value[a.value],k={user_id:T,user_name:_,question_name:l.name,select_option:$,time_spent:v};try{const h=yield(yield fetch("/api/method/kbc.api.game_session.save_single_answer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:JSON.stringify(k)})})).json();if(console.log("✅ API Response:",h),h.message==="success"||((Q=h.message)==null?void 0:Q.message)==="success")alert("✅ Answer submitted successfully"),f.value.push(e.value),e.value<n.value.length-1?x():setTimeout(()=>{s.push("/Leaderboard")},2e3);else{const E=typeof h.message=="object"?JSON.stringify(h.message):h.message;alert("⚠️ Failed: "+E)}}catch(A){console.error("❌ Network/API error:",A),alert("❌ Network error: "+A.message)}});return(v,l)=>(u(),c("div",ve,[l[1]||(l[1]=m("h1",{class:"title"},"Fastest Finger First",-1)),w(H,{questions:n.value,activeIndex:e.value,disabledQuestions:f.value,onSelectQuestion:y},null,8,["questions","activeIndex","disabledQuestions"]),w(ie,{ref_key:"timerRef",ref:o},null,512),w(se,{question:p.value,options:d.value,selectedOption:a.value,onSelectOption:q},null,8,["question","options","selectedOption"]),m("div",pe,[m("button",{disabled:a.value===null,onClick:D}," Submit ",8,_e)]),w(me),l[2]||(l[2]=m("h1",{class:"text-center text-3xl mt-3 font-bold text-yellow-400 hover:text-yellow-300 transition duration-300"},null,-1)),i.value?(u(),c("div",fe," Time Spent: "+g(i.value),1)):I("",!0),b.value?(u(),c("div",ge,l[0]||(l[0]=[m("h2",{class:"transition-text"},"Get Ready for Next Question!",-1)]))):I("",!0)]))}},Se=S(be,[["__scopeId","data-v-9d095f5e"]]);export{Se as default};
